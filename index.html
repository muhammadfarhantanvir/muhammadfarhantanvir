<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muhammad Farhan Tanvir | Data Scientist Profile</title>
    <!-- Load Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter Font --><link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    
    <style>
        /* --- CUSTOM ANIMATIONS --- */
        /* Subtle Pulse Effect for Skill Cards (Purple Glow on Light BG) */
        @keyframes subtle-pulse {
            0%, 100% {
                /* Reduced opacity shadow */
                box-shadow: 0 0 5px rgba(126, 34, 206, 0.1), 0 0 0px rgba(126, 34, 206, 0);
            }
            50% {
                /* Higher opacity shadow */
                box-shadow: 0 0 15px rgba(126, 34, 206, 0.3), 0 0 10px rgba(126, 34, 206, 0.05);
            }
        }
        
        /* --- STYLING --- */
        /* Apply the animation and enhanced transitions */
        .skill-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
            animation: subtle-pulse 4s infinite ease-in-out;
        }
        .skill-card:hover {
            transform: translateY(-8px) scale(1.05); /* Increased lift and scale on hover */
            /* Deeper shadow on hover for white background */
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15), 0 0 30px rgba(126, 34, 206, 0.5);
            background-color: #fcfcfc; /* Very slight white change */
        }
        
        /* Root styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fefefe; /* Near-white background for depth */
            color: #1a202c; /* Darker base text */
        }
        /* Refined Section Header with Bolder Accent */
        .section-header {
            border-left: 6px solid #9333ea; /* Stronger Purple accent: VIOLET-600 */
            padding-left: 1.5rem; /* More space */
            color: #1a202c; 
            font-weight: 700;
        }
        
        /* Generic class replacements for the light theme */
        .card-bg {
            background-color: #ffffff; /* Pure white cards */
            border: 1px solid #e5e5e5; /* Lighter border */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); /* Subtle default shadow */
        }
        .card-bg:hover {
            background-color: #f9f9f9; /* Very slight background change on hover */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        .view-card {
            /* Lighter, more modern focus style */
            border: 2px solid #a855f7;
            background-color: #f7f3ff; /* Very light purple background */
        }

        /* Custom Bullet Style for lists in experience/projects */
        .custom-list {
            list-style: none; /* Remove default bullets */
            padding-left: 0;
        }
        .custom-list li {
            position: relative;
            padding-left: 1.75rem; /* Space for the custom bullet */
            margin-bottom: 0.5rem;
        }
        .custom-list li::before {
            content: '‚Ä¢'; /* Use a cleaner dot or other character */
            position: absolute;
            left: 0;
            color: #9333ea; /* Match accent color */
            font-weight: 900;
            font-size: 1.2rem;
            line-height: 1;
        }
    </style>
</head>
<body class="p-4 md:p-8 lg:p-12">

    <div class="max-w-6xl mx-auto">

        <!-- HEADER & CONTACT SECTION -->
        <header class="text-center mb-16 py-10 rounded-xl bg-gray-50/70 border border-gray-100 shadow-sm">
            <h1 class="text-6xl md:text-7xl font-black text-gray-900 mb-3 tracking-tighter">
                Muhammad Farhan Tanvir
            </h1>
            
            <!-- Static Text Section -->
            <h2 class="text-2xl md:text-3xl font-light text-gray-700 mb-8">
                <span class="font-semibold text-gray-900">üöÄ Data Scientist</span> | Specialized in <span class="font-extrabold text-purple-700">NLP, AI Agent, RAG and LLMs</span>
            </h2>

            <!-- Contact Links -->
            <div class="flex flex-wrap justify-center space-x-3 md:space-x-6">
                <!-- Links (Using original badge format for dynamic loading) -->
                <a href="https://www.linkedin.com/in/muhammad-farhan-tanvir" target="_blank" class="transform hover:scale-105 transition duration-300">
                    <img src="https://img.shields.io/badge/LinkedIn-0077B5?style=for-the-badge&logo=linkedin&logoColor=white" alt="LinkedIn">
                </a>
                <a href="https://farhan-ai-insights.lovable.app" target="_blank" class="transform hover:scale-105 transition duration-300">
                    <img src="https://img.shields.io/badge/Portfolio-FF5722?style=for-the-badge&logo=todoist&logoColor=white" alt="Portfolio">
                </a>
                <a href="mailto:tanvirf07@gmail.com" class="transform hover:scale-105 transition duration-300">
                    <img src="https://img.shields.io/badge/Email-D14836?style=for-the-badge&logo=gmail&logoColor=white" alt="Email">
                </a>
            </div>
        </header>

        <!-- ABOUT ME / PHILOSOPHY -->
        <section class="mb-16 p-8 card-bg rounded-2xl shadow-xl border border-purple-200/50">
            <blockquote class="italic text-xl md:text-2xl text-center text-purple-700 font-medium">
                "Transforming complex data into actionable insights through cutting-edge AI and machine learning solutions"
            </blockquote>
            <p class="mt-6 text-gray-700 text-center text-lg leading-relaxed">
                <span class="font-semibold text-gray-900">Data Scientist</span> with **3+ years of experience** in NLP, LLMs, and AI-driven analytics. Master's student at Universit√§t Potsdam, currently based in Dortmund, Germany. Passionate about building <span class="text-purple-700 font-semibold">interpretable, ethical, and human-centered</span> AI systems.
            </p>
        </section>

        <!-- ANIMATED TECH STACK & EXPERTISE -->
        <div class="mb-16">
            <h3 class="section-header text-4xl font-extrabold mb-10 text-gray-900">
                Tech Stack & Core Expertise
            </h3>

            <!-- Grid of Animated Skills -->
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-6">
                
                <!-- Programming Languages -->
                <div class="skill-card bg-white p-5 rounded-xl flex flex-col items-center justify-center text-center border border-purple-200 hover:bg-gray-50 shadow-lg">
                    <span class="text-4xl mb-1 text-yellow-500">üêç</span>
                    <p class="font-bold text-gray-900">Python</p>
                    <small class="text-purple-600 font-medium">ML / Data</small>
                </div>
                <div class="skill-card bg-white p-5 rounded-xl flex flex-col items-center justify-center text-center border border-purple-200 hover:bg-gray-50 shadow-lg">
                    <span class="text-4xl mb-1 text-blue-500">¬Æ</span>
                    <p class="font-bold text-gray-900">R</p>
                    <small class="text-purple-600 font-medium">Statistical Modeling</small>
                </div>

                <!-- AI/ML Frameworks -->
                <div class="skill-card bg-white p-5 rounded-xl flex flex-col items-center justify-center text-center border border-purple-200 hover:bg-gray-50 shadow-lg">
                    <span class="text-4xl mb-1 text-red-600">üß†</span>
                    <p class="font-bold text-gray-900">TensorFlow/Keras</p>
                    <small class="text-purple-600 font-medium">Deep Learning</small>
                </div>
                <div class="skill-card bg-white p-5 rounded-xl flex flex-col items-center justify-center text-center border border-purple-200 hover:bg-gray-50 shadow-lg">
                    <span class="text-4xl mb-1 text-orange-600">‚ö°</span>
                    <p class="font-bold text-gray-900">PyTorch</p>
                    <small class="text-purple-600 font-medium">Research & LLMs</small>
                </div>
                <div class="skill-card bg-white p-5 rounded-xl flex flex-col items-center justify-center text-center border border-purple-200 hover:bg-gray-50 shadow-lg">
                    <span class="text-4xl mb-1 text-cyan-500">üß™</span>
                    <p class="font-bold text-gray-900">Scikit-Learn</p>
                    <small class="text-purple-600 font-medium">Classic ML</small>
                </div>

                <!-- Data/LLM Ecosystem -->
                <div class="skill-card bg-white p-5 rounded-xl flex flex-col items-center justify-center text-center border border-purple-200 hover:bg-gray-50 shadow-lg">
                    <span class="text-4xl mb-1 text-green-500">üí¨</span>
                    <p class="font-bold text-gray-900">LangChain</p>
                    <small class="text-purple-600 font-medium">RAG / Agents</small>
                </div>
                <div class="skill-card bg-white p-5 rounded-xl flex flex-col items-center justify-center text-center border border-purple-200 hover:bg-gray-50 shadow-lg">
                    <span class="text-4xl mb-1 text-gray-700">üíæ</span>
                    <p class="font-bold text-gray-900">SQL/BigQuery</p>
                    <small class="text-purple-600 font-medium">Data Warehousing</small>
                </div>
                <div class="skill-card bg-white p-5 rounded-xl flex flex-col items-center justify-center text-center border border-purple-200 hover:bg-gray-50 shadow-lg">
                    <span class="text-4xl mb-1 text-amber-600">üìà</span>
                    <p class="font-bold text-gray-900">Pandas/NumPy</p>
                    <small class="text-purple-600 font-medium">Data Prep</small>
                </div>

                <!-- Cloud & MLOps -->
                <div class="skill-card bg-white p-5 rounded-xl flex flex-col items-center justify-center text-center border border-purple-200 hover:bg-gray-50 shadow-lg">
                    <span class="text-4xl mb-1 text-blue-600">‚òÅÔ∏è</span>
                    <p class="font-bold text-gray-900">GCP/AWS/Azure</p>
                    <small class="text-purple-600 font-medium">Deployment</small>
                </div>
                <div class="skill-card bg-white p-5 rounded-xl flex flex-col items-center justify-center text-center border border-purple-200 hover:bg-gray-50 shadow-lg">
                    <span class="text-4xl mb-1 text-sky-500">üê≥</span>
                    <p class="font-bold text-gray-900">Docker</p>
                    <small class="text-purple-600 font-medium">Containerization</small>
                </div>
                <div class="skill-card bg-white p-5 rounded-xl flex flex-col items-center justify-center text-center border border-purple-200 hover:bg-gray-50 shadow-lg">
                    <span class="text-4xl mb-1 text-teal-500">üé®</span>
                    <p class="font-bold text-gray-900">Tableau/PowerBI</p>
                    <small class="text-purple-600 font-medium">Data Viz</small>
                </div>
                <div class="skill-card bg-white p-5 rounded-xl flex flex-col items-center justify-center text-center border border-purple-200 hover:bg-gray-50 shadow-lg">
                    <span class="text-4xl mb-1 text-red-500">‚öôÔ∏è</span>
                    <p class="font-bold text-gray-900">MLOps</p>
                    <small class="text-purple-600 font-medium">Pipelines</small>
                </div>
            </div>
        </div>

        <!-- PROFESSIONAL EXPERIENCE -->
        <div class="mb-16">
            <h3 class="section-header text-4xl font-extrabold mb-10 text-gray-900">
                Professional & Research Experience
            </h3>

            <!-- Current Role -->
            <div class="p-8 card-bg rounded-2xl shadow-xl mb-6 border-t-4 border-purple-500">
                <p class="text-xl font-bold text-gray-900">Data Scientist</p>
                <p class="text-purple-700 font-medium">Institut f√ºr Marktforschung, Statistik und Prognose (IMSP) | Munich, Germany</p>
                <p class="text-sm text-gray-500 mb-4">Apr 2023 ‚Äì Sep 2025</p>
                <ul class="custom-list text-gray-700 ml-4 space-y-2 text-lg">
                    <li>Deployed sales forecasting models on Google Cloud Platform using BigQuery, ensuring operational scalability.</li>
                    <li>Improved data quality by 20% through automated cleaning pipelines, enhancing model reliability.</li>
                </ul>
            </div>

            <!-- Research Experience -->
            <div class="p-8 card-bg rounded-2xl shadow-xl border-t-4 border-purple-500">
                <p class="text-xl font-bold text-gray-900">Research Assistant</p>
                <p class="text-purple-700 font-medium">Technische Universit√§t Dortmund | May 2024 ‚Äì Oct 2024</p>
                <ul class="custom-list text-gray-700 ml-4 space-y-2 text-lg">
                    <li>Developed interactive warehouse planning modeling environments for complex logistical analysis.</li>
                    <li>Supported evidence-based decision-making through comprehensive data analysis.</li>
                </ul>
            </div>
        </div>

        <!-- FEATURED PROJECTS -->
        <div class="mb-16">
            <h3 class="section-header text-4xl font-extrabold mb-10 text-gray-900">
                Featured Data Science Projects
            </h3>
            
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Project 1 -->
                <div class="p-6 card-bg rounded-2xl shadow-xl border-t-4 border-purple-600 hover:shadow-2xl transition duration-300">
                    <h4 class="text-xl font-bold text-gray-900 mb-2">ü§ñ Coding Documentation Generator (LLMs)</h4>
                    <p class="text-sm text-purple-600 font-medium mb-3">Stack: Streamlit, Ollama, LangChain, DeepSeek LLMs</p>
                    <ul class="custom-list text-gray-700 ml-4 space-y-2">
                        <li>Automated code documentation using DeepSeek R1-1.5B/Coder-6.7B for efficiency.</li>
                        <li>Built robust LangChain pipelines for dynamic docstring generation across repositories.</li>
                    </ul>
                </div>
                <!-- Project 2 -->
                <div class="p-6 card-bg rounded-2xl shadow-xl border-t-4 border-teal-600 hover:shadow-2xl transition duration-300">
                    <h4 class="text-xl font-bold text-gray-900 mb-2">üéØ Advanced Uncertainty Quantification</h4>
                    <p class="text-sm text-purple-600 font-medium mb-3">Stack: PyTorch, FastAI, Neptune AI, Plotly</p>
                    <ul class="custom-list text-gray-700 ml-4 space-y-2">
                        <li>Customized ConvNeXt model for CIFAR-10 classification with advanced metrics.</li>
                        <li>Implemented aleatoric & epistemic uncertainty analysis to enhance model reliability.</li>
                    </ul>
                </div>
                <!-- Project 3 -->
                <div class="p-6 card-bg rounded-2xl shadow-xl border-t-4 border-amber-600 hover:shadow-2xl transition duration-300">
                    <h4 class="text-xl font-bold text-gray-900 mb-2">üëÅÔ∏è Real-Time Object Detection (YOLOv6)</h4>
                    <p class="text-sm text-purple-600 font-medium mb-3">Stack: OpenCV, YOLOv6, NumPy</p>
                    <ul class="custom-list text-gray-700 ml-4 space-y-2">
                        <li>Fine-tuned YOLOv6 for custom object detection, optimizing detection performance.</li>
                        <li>Achieved high accuracy using mAP, precision, recall metrics on real-world data.</li>
                    </ul>
                </div>
                <!-- Project 4 -->
                <div class="p-6 card-bg rounded-2xl shadow-xl border-t-4 border-pink-600 hover:shadow-2xl transition duration-300">
                    <h4 class="text-xl font-bold text-gray-900 mb-2">üìä Sales Performance Dashboard</h4>
                    <p class="text-sm text-purple-600 font-medium mb-3">Stack: Power BI, Data Visualization, SQL</p>
                    <ul class="custom-list text-gray-700 ml-4 space-y-2">
                        <li>Created comprehensive sales analytics dashboard visualized key performance indicators.</li>
                        <li>Enabled data-driven shipping optimization strategies leading to cost reduction.</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- GITHUB ANALYTICS & EDUCATION -->
        <div class="grid md:grid-cols-2 gap-10 mb-16">
            <!-- Analytics -->
            <div>
                <h3 class="section-header text-4xl font-extrabold mb-10 text-gray-900">
                    Profile Analytics (Live)
                </h3>
                <div class="space-y-6">
                    
                    <!-- CUSTOM TOP LANGUAGES CARD (98% Python, 2% R) -->
                    <div class="p-6 card-bg rounded-2xl shadow-xl border border-gray-200">
                        <h4 class="text-2xl font-bold text-gray-900 mb-4 text-center">Top Language Distribution</h4>
                        <div class="space-y-4">
                            <!-- Python 98% -->
                            <div>
                                <div class="flex justify-between text-base font-medium text-gray-700">
                                    <span class="flex items-center">
                                        <span class="w-3.5 h-3.5 bg-yellow-500 rounded-full mr-2"></span> Python
                                    </span>
                                    <span>98%</span>
                                </div>
                                <div class="w-full bg-gray-300 rounded-full h-3">
                                    <div class="bg-yellow-500 h-3 rounded-full" style="width: 98%;"></div>
                                </div>
                            </div>
                            <!-- R 2% -->
                            <div>
                                <div class="flex justify-between text-base font-medium text-gray-700">
                                    <span class="flex items-center">
                                        <span class="w-3.5 h-3.5 bg-blue-500 rounded-full mr-2"></span> R
                                    </span>
                                    <span>2%</span>
                                </div>
                                <div class="w-full bg-gray-300 rounded-full h-3">
                                    <div class="bg-blue-500 h-3 rounded-full" style="width: 2%;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Views per period (Now Live) -->
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
                        <div class="p-6 view-card rounded-2xl shadow-lg flex flex-col items-center border border-purple-300">
                            <h4 class="text-lg font-semibold text-gray-800 mb-2">Views per Day</h4>
                            <!-- Placeholder for Live Data -->
                            <div id="views-day" class="text-4xl font-bold text-purple-800">0</div>
                            <span class="text-purple-600 text-sm mt-1">üìà Live Count</span>
                        </div>
                        <div class="p-6 view-card rounded-2xl shadow-lg flex flex-col items-center border border-purple-300">
                            <h4 class="text-lg font-semibold text-gray-800 mb-2">Views per Week</h4>
                            <!-- Placeholder for Live Data -->
                            <div id="views-week" class="text-4xl font-bold text-purple-800">0</div>
                            <span class="text-purple-600 text-sm mt-1">üìä Live Count</span>
                        </div>
                        <div class="p-6 view-card rounded-2xl shadow-lg flex flex-col items-center border border-purple-300">
                            <h4 class="text-lg font-semibold text-gray-800 mb-2">Views per Month</h4>
                            <!-- Placeholder for Live Data -->
                            <div id="views-month" class="text-4xl font-bold text-purple-800">0</div>
                            <span class="text-purple-600 text-sm mt-1">üóìÔ∏è Live Count</span>
                        </div>
                    </div>
                    <!-- Note for the user about the live data -->
                    <p class="text-xs text-center text-gray-500 italic pt-2">
                        *Profile views are tracked and incremented live using the Firestore database. Counts reset automatically based on server time for Day, Week (Monday start), and Month.
                    </p>
                </div>
            </div>
            
            <!-- Education -->
            <div>
                <h3 class="section-header text-4xl font-extrabold mb-10 text-gray-900">
                    Education & Languages
                </h3>
                <div class="p-8 card-bg rounded-2xl shadow-xl border-t-4 border-gray-400 mb-6">
                    <p class="text-xl font-bold text-gray-900">Master of Science in Data Science</p>
                    <p class="text-purple-700 font-medium mb-3">Universit√§t Potsdam | 2022 ‚Äì Present</p>
                </div>
                <div class="p-8 card-bg rounded-2xl shadow-xl border-t-4 border-gray-400">
                    <p class="text-xl font-bold text-gray-900 mb-4">Language Proficiency</p>
                    <ul class="text-gray-700 space-y-3">
                        <li><span class="font-semibold text-gray-900">üáßüá© Bengali:</span> Native Speaker</li>
                        <li><span class="font-semibold text-gray-900">üá¨üáß English:</span> C1 (Advanced)</li>
                        <li><span class="font-semibold text-gray-900">üá©üá™ German:</span> B1 (Intermediate)</li>
                    </ul>
                </div>
            </div>
        </div>


        <!-- FOOTER / CALL TO ACTION -->
        <footer class="text-center py-10 border-t-4 border-purple-500/50 mt-16 bg-gray-50 rounded-lg">
            <h4 class="text-3xl font-bold text-purple-700 mb-3">
                ü§ù Let's Collaborate!
            </h4>
            <p class="text-gray-700 mb-6 max-w-3xl mx-auto text-lg">
                I'm always excited to discuss innovative data science projects, from NLP research to scalable deep learning applications. Feel free to connect via the links above!
            </p>
            <div class="text-xl font-medium text-gray-500">
                <span class="text-purple-700">*"Turning data into decisions"*</span> üöÄ
            </div>
        </footer>

    </div>
    
    <!-- Firebase Initialization and View Tracking Script (UNCHANGED LOGIC) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        // NOTE: Added getDoc to the import list for reliable one-time read
        import { getFirestore, doc, onSnapshot, setDoc, getDoc, increment, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Use global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth;
        const VIEW_DOC_PATH = `/artifacts/${appId}/public/data/profile_views/main_tracker`;

        // Utility function to determine if a period needs resetting
        function needsReset(lastResetTimestamp, unit) {
            if (!lastResetTimestamp) return true;

            const now = new Date();
            const lastReset = lastResetTimestamp.toDate ? lastResetTimestamp.toDate() : new Date(lastResetTimestamp);
            
            switch (unit) {
                case 'day':
                    return now.toDateString() !== lastReset.toDateString();
                case 'week':
                    // Monday is day 1, Sunday is day 0. We want Monday as the start of the week.
                    const startOfWeekNow = new Date(now);
                    const dayNow = (now.getDay() + 6) % 7; // Monday=0, Sunday=6
                    startOfWeekNow.setDate(now.getDate() - dayNow);
                    startOfWeekNow.setHours(0, 0, 0, 0);

                    const startOfWeekLastReset = new Date(lastReset);
                    const dayLastReset = (lastReset.getDay() + 6) % 7;
                    startOfWeekLastReset.setDate(lastReset.getDate() - dayLastReset);
                    startOfWeekLastReset.setHours(0, 0, 0, 0);

                    return startOfWeekNow.getTime() !== startOfWeekLastReset.getTime();
                case 'month':
                    return now.getMonth() !== lastReset.getMonth() || now.getFullYear() !== lastReset.getFullYear();
                default:
                    return false;
            }
        }

        async function initFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // 1. Authenticate
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                // 2. Start tracking and listening after auth
                trackView();
                setupRealtimeListener();

            } catch (error) {
                console.error("Firebase initialization or authentication failed:", error);
            }
        }
        
        // Refactored to use getDoc for a reliable one-time state fetch before updating.
        async function trackView() {
            if (!db) return; // Guard clause if DB didn't initialize

            const viewRef = doc(db, VIEW_DOC_PATH);

            try {
                // 1. Get the current document state using getDoc
                const docSnap = await getDoc(viewRef);
                const data = docSnap.data() || {};
                
                const {
                    dailyLastReset, 
                    weeklyLastReset, 
                    monthlyLastReset
                } = data;
                
                // 2. Prepare update object with increments (defaulting to +1)
                const updateData = {
                    dailyViews: increment(1),
                    weeklyViews: increment(1),
                    monthlyViews: increment(1),
                    lastViewed: serverTimestamp() // Always update the last viewed time
                };

                // 3. Check and apply resets if necessary
                if (needsReset(dailyLastReset, 'day')) {
                    updateData.dailyViews = 1; // Reset to 1 (current view)
                    updateData.dailyLastReset = serverTimestamp();
                }
                if (needsReset(weeklyLastReset, 'week')) {
                    updateData.weeklyViews = 1; // Reset to 1 (current view)
                    updateData.weeklyLastReset = serverTimestamp();
                }
                if (needsReset(monthlyLastReset, 'month')) {
                    updateData.monthlyViews = 1; // Reset to 1 (current view)
                    updateData.monthlyLastReset = serverTimestamp();
                }
                
                // 4. Update the document (creates it if it doesn't exist)
                await setDoc(viewRef, updateData, { merge: true });

            } catch (error) {
                console.error("Error updating view count:", error);
            }
        }

        function setupRealtimeListener() {
            if (!db) return;

            const viewRef = doc(db, VIEW_DOC_PATH);
            
            // This is kept as onSnapshot to provide real-time updates to the UI
            onSnapshot(viewRef, (docSnap) => {
                const data = docSnap.data();
                
                // Get current values (or 0 if not present)
                const currentDaily = data?.dailyViews || 0;
                const currentWeekly = data?.weeklyViews || 0;
                const currentMonthly = data?.monthlyViews || 0;

                // Update the DOM elements
                const viewsDayEl = document.getElementById('views-day');
                const viewsWeekEl = document.getElementById('views-week');
                const viewsMonthEl = document.getElementById('views-month');

                if (viewsDayEl) viewsDayEl.textContent = currentDaily;
                if (viewsWeekEl) viewsWeekEl.textContent = currentWeekly;
                if (viewsMonthEl) viewsMonthEl.textContent = currentMonthly;

            }, (error) => {
                console.error("Error listening to view changes:", error);
                // Fallback to displaying error on failure
                if (document.getElementById('views-day')) document.getElementById('views-day').textContent = 'Error';
                if (document.getElementById('views-week')) document.getElementById('views-week').textContent = 'Error';
                if (document.getElementById('views-month')) document.getElementById('views-month').textContent = 'Error';
            });
        }

        window.onload = initFirebase;
    </script>

</body>
</html>
